# ==============================================================================
# SLATE v2.1 BROKER CONFIGURATION
# ------------------------------------------------------------------------------
# This file controls the "Post Office" (Mosquitto).
# It decides who can connect, which ports are open, and where to save data.
# ==============================================================================

# 1. PERSISTENCE (The Memory)
# ------------------------------------------------------------------------------
# "true" = Save messages to the hard drive.
# If the container crashes or restarts, the broker remembers the last known state.
persistence true

# This path maps to the volume 'mosquitto_data' in docker-compose.yml
persistence_location /mosquitto/data/

# 2. LOGGING (The Black Box)
# ------------------------------------------------------------------------------
# Where to write the history of events.
log_dest file /mosquitto/log/mosquitto.log

# What to record. "all" is very chatty, but good for learning.
# It shows every connection, disconnection, and message published.
log_type all

# Makes the logs readable for humans (ISO 8601 Format)
log_timestamp_format %Y-%m-%dT%H:%M:%S

# 3. LISTENERS (The Doors)
# ------------------------------------------------------------------------------
# Door 1: Standard MQTT (Port 1883)
# Used by: ESP32, Python Scripts, Telegraf.
listener 1883
# "0.0.0.0" means "listen for connections from anywhere" (Laptop, WiFi, Docker)
allow_anonymous true

# Door 2: WebSockets (Port 9001)
# Used by: Web Browsers (if you build a custom JS dashboard later).
listener 9001
protocol websockets

# 4. SECURITY (The Bouncer)
# ------------------------------------------------------------------------------
# allow_anonymous true:
#   ANYONE can connect without a password.
#   Why? It reduces friction for beginners.
#   WARNING: In a real factory, this must be 'false'.
allow_anonymous true